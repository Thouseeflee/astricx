<%- layout('./layout/boilerplate') %> 
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" integrity="sha512-1ycn6IcaQQ40/MKBW2W4Rhis/DbILU74C1vSrLJxCq57o941Ym01SwNsOMqvEBFlcgUa6xLiPY/NS5R+E6ztJQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />

<!-- <h1>Comments</h1> -->

<div class="container-fluid">
    <div class="row">
        
        <div class="col-12 offset-md-4 col-md-4">
            <h2 class="text-center"><%= Card.name %> </h2>
              <div class="card mt-3">
                <img src="<%= Card.image.url%> " class="" width="" alt="...">
                  <div class="card-body">
                    <h5 class="card-title"><%= Card.name %> </h5>
                    <div class="card-text text-muted">
                      <%#= date%>  
                    </div>
                    <!-- <h6 class="card-subtitle mb-2 text-muted">Card subtitle</h6> -->
                    <p class="card-text mt-1 text-center"><%= Card.about %> </p>
                    <!-- <a href="#" class="card-link">Card link</a> -->
                    <!-- <a href="#" class="card-link">Another link</a> -->
                  </div>
                  <form class="card-subtitle mb-2 text-center" action="/<%=id%>/show/<%=Card._id%>/likes" method="GET">
                    <%# for (let lakes of Like){ %>
                    
                    <% if(currentUser) {%>  
      
                      
                        <% if(Card.likes.some(function (like) {return like === currentUser.username})) {%> 
                          <!-- <img src="https://cdn-icons-png.flaticon.com/512/786/786432.png" width="60px" class="btn" alt=""> -->
                        <!-- <a data=<%#=card._id%> data-1=<%#=Title._id%> class="btn btn-success button">Liked</a> -->
                        <i class="btn fas fa-star btn-like button liked" data=<%=Card._id%> data-1=<%=id%>  data-value="Liked"></i>  
                        
                        <!-- <fieldset class="starability-grow">
                          <input type="radio" id="no-rate" class="input-no-rate" name="rating" value="0"  aria-label="No rating." />
                          <input type="radio" id="first-rate1" name="rating" value="1" />
                          <label for="first-rate1" title="Terrible">1 star</label>
                        </fieldset> -->
                        
                        
                        <span class="nLikes"><%= Card.likes.length %></span>
                        <% } else { %> 
                          <!-- <img src="https://cdn-icons-png.flaticon.com/512/786/786230.png" width="60px" class="btn" alt=""> -->
                          <!-- <a data=<%#=card._id%> data-1=<%#=Title._id%> value="0" class="btn btn-secondary button">Like</a> -->
      
            
                          <i class="btn fas fa-star btn-like button unLiked"   data=<%=Card._id%> data-1=<%=id%>  data-value="Like"></i>  
      
                          <!-- <fieldset class="starability-grow">
                            <input type="radio" id="no-rate" class="input-no-rate" name="rating" value="0" checked aria-label="No rating." />
                            <input type="radio" id="first-rate1" name="rating" value="1" />
                            <label for="first-rate1" title="Terrible">0 star</label>
                          </fieldset> -->
      
                        <span class="nLikes"><%= Card.likes.length %></span>
                          <% } %> 
                                   
                        <% } %>
                      
                      <%# } %> 
                  </form>
                  
                  <div class="card-footer text-end">
                    <a href="/<%=Card.creator%>"> <img src="<%= Card.creatorProfile.profile%>" alt=""></a> 
                  </div>
      
                </div>
              </div>





        <div class="col-md-4 offset-md-4">
            <form action="/<%=id%>/show/<%=cardId%>/comments" method="POST">

            <textarea name="comment" class="form-control" id="" cols="60" placeholder="Leave a Comment" rows="2"></textarea>
<p>      
    <button  class="btn btn-success mt-2 submit" data-1=<%=id%> data-2=<%=cardId%> >Comment</button>
</p>
</form>
        </div>
        <div class="col-md-12">
            <% for(let Comment of comment) {%> 
            <div class="card comment mt-1 none" style="width: 19rem;">
                <div class="card-body">
                    <a href="/<%=Comment.user%> "><img src="<%=Comment.creatorProfile.profile%> " alt=""><span class="card-title c-user"><%=Comment.user%></span>
                    </a>
                  <p class="card-text mt-2"><%=Comment.comment%></p>
                  <form action="/<%=id%>/show/<%=cardId%>/comments/<%=Comment._id%>?_method=DELETE" method="POST">
                      <button class="btn btn-sm btn-danger delete" type="submit" data-1=<%=id%> data-2=<%=cardId%> data-3=<%=Comment._id%> >
                          Delete</button>
                  </form>
                </div>
              </div>
              <% } %> 
        </div>
    </div>
</div>

<script>
    const deleted =document.querySelectorAll('.delete');
    const display =document.querySelectorAll('.none');
    const submit =document.querySelector('.submit')


    // submit.addEventListener('click', async function(e) {
    //     e.preventDefault();
    //     const id =this.getAttribute('data-1')
    //     const cardId =this.getAttribute('data-2')
    //     axios.post(`/${id}/show/${cardId}/comments`)
    //        .then(function(res){
    //           console.log(res.data);
    //        })
    //        .catch(function(e){
    //            console.log(e);
    //        })
    // })
    
 for(let deletes of deleted){


    deletes.addEventListener('click', function(e){
        e.preventDefault();

        this.parentElement.parentElement.parentElement.classList = "display"
        const id =this.getAttribute('data-1')
        const cardId =this.getAttribute('data-2')
        const cId =this.getAttribute('data-3')
        axios.delete(`/${id}/show/${cardId}/comments/${cId}`)
    })
 }
</script>